import{d as L,k as P,a as O,e as I,r as h,l as T,j as e,X as $,m as W,n as J,o as Z,R as X,f as G,B as D,D as ee,c as se,p as re,u as ae,S as C,i as le}from"./index-XESJNA6v.js";import{E as te}from"./EmptyState-BRjS5MyD.js";import{C as V}from"./chevron-down-Cc4qbPYb.js";import{T as ne}from"./trash-2-BWGgcqO4.js";import{P as U,S as oe}from"./search-rnktevF7.js";import{M as ce}from"./map-pin-W7mQtlfA.js";import{P as de}from"./plus-Dfe9gStt.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=L("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=L("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=L("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=L("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=L("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),g=({label:a,children:s})=>e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:a}),s]}),F=({id:a,name:s,value:p,onChange:j,options:v})=>e.jsxs("div",{className:"relative",children:[e.jsx("select",{id:a,name:s,value:p,onChange:j,className:"w-full appearance-none bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-3 pr-10",children:v.map(x=>e.jsx("option",{value:x,children:x},x))}),e.jsx(V,{className:"w-4 h-4 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none"})]});function he({onClose:a,initialData:s}){var f,A,S,M;const{createLead:p,updateLead:j}=P(),{user:v}=O(),{addNotification:x}=I(),[b,l]=h.useState(!1),c=s?"edit":"add",[r,i]=h.useState({fullName:(s==null?void 0:s.full_name)||"",email:(s==null?void 0:s.email)||"",company:(s==null?void 0:s.company_name)||"",location:(s==null?void 0:s.location)||"Dubai",mobile:(s==null?void 0:s.phone.replace("+971","").trim())||"",salary:((f=s==null?void 0:s.monthly_salary)==null?void 0:f.toString())||"",bank:(s==null?void 0:s.bank_name)||"Emirates Islamic Bank",productType:(s==null?void 0:s.product_type)||"Credit Card",product:(s==null?void 0:s.product)||T[0].name,referral:(s==null?void 0:s.referral_source)||"",salaryMonths:((A=s==null?void 0:s.salary_months)==null?void 0:A.toString())||"",salaryVariations:(s==null?void 0:s.salary_variations)||!1,existingCards:(s==null?void 0:s.existing_cards)||!1,cardsDuration:(s==null?void 0:s.cards_duration)||"",totalCreditLimit:((S=s==null?void 0:s.total_credit_limit)==null?void 0:S.toString())||"",hasEmi:(s==null?void 0:s.has_emi)||!1,emiAmount:((M=s==null?void 0:s.emi_amount)==null?void 0:M.toString())||"",appliedRecently:(s==null?void 0:s.applied_recently)||!1,documentsAvailable:(s==null?void 0:s.documents_available)||[]}),[_,w]=h.useState(T.map(d=>d.name)),[o,n]=h.useState(!0);h.useEffect(()=>{let d=[],m=!1;r.bank==="Emirates Islamic Bank"&&r.productType==="Credit Card"?(d=T.map(y=>y.name),m=!0):r.productType==="Account Opening"&&(d=["Personal Account","Business Account"],m=!0),w(d),n(m),i(y=>({...y,product:m?d[0]||"":y.productType}))},[r.bank,r.productType]);const t=d=>{const{name:m,value:y}=d.target;i(k=>({...k,[m]:y}))},N=async d=>{if(d.preventDefault(),!v){x("Authentication Error","You must be logged in.");return}if(!r.fullName||!r.mobile){alert("Please fill in Full Name and Mobile Number.");return}l(!0);const m={full_name:r.fullName,email:r.email,phone:`+971 ${r.mobile}`,company_name:r.company,monthly_salary:parseInt(r.salary,10)||null,loan_amount_requested:0,product_interest:[r.product.toLowerCase().replace(/ /g,"_")],qualification_status:(s==null?void 0:s.qualification_status)||"warm",last_contact_date:new Date().toISOString().split("T")[0],urgency_level:(s==null?void 0:s.urgency_level)||"medium",location:r.location,referral_source:r.referral||"Manual Entry",bank_name:r.bank,product_type:r.productType,product:r.product,user_id:v.id,salary_months:parseInt(r.salaryMonths,10)||null,salary_variations:r.salaryVariations,existing_cards:r.existingCards,cards_duration:r.cardsDuration,total_credit_limit:parseFloat(r.totalCreditLimit)||null,has_emi:r.hasEmi,emi_amount:parseFloat(r.emiAmount)||null,applied_recently:r.appliedRecently,documents_available:r.documentsAvailable};c==="add"?p.mutate(m,{onSuccess:()=>{x("Lead Created",`${r.fullName} has been saved.`),a()},onError:y=>{x("Error",y.message),l(!1)}}):j.mutate({id:s.id,updates:m},{onSuccess:()=>{x("Lead Updated",`${r.fullName} has been saved.`),a()},onError:y=>{x("Error",y.message),l(!1)}})};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex justify-center items-end animate-fade-in sm:items-center",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-t-2xl sm:rounded-2xl shadow-xl transform transition-transform animate-slide-up flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 flex-shrink-0",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:c==="add"?"Add New Lead":"Edit Lead"}),e.jsx("button",{onClick:a,className:"p-2 -mr-2 rounded-full hover:bg-gray-100",children:e.jsx($,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("form",{onSubmit:N,className:"flex-1 flex flex-col min-h-0",children:[e.jsx("main",{className:"flex-1 p-6 overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(g,{label:"Full Name*",children:e.jsx("input",{type:"text",name:"fullName",value:r.fullName,onChange:t,required:!0,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})}),e.jsx(g,{label:"Email",children:e.jsx("input",{type:"email",name:"email",value:r.email,onChange:t,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3",placeholder:"example@email.com"})}),e.jsx(g,{label:"Company Name",children:e.jsx("input",{type:"text",name:"company",value:r.company,onChange:t,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})}),e.jsx(g,{label:"Location",children:e.jsx(F,{id:"location",name:"location",value:r.location,onChange:t,options:W})}),e.jsx(g,{label:"Mobile Number*",children:e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"inline-flex items-center px-3 text-sm text-gray-900 bg-gray-50 border border-r-0 border-gray-300 rounded-l-lg",children:"+971"}),e.jsx("input",{type:"tel",name:"mobile",value:r.mobile,onChange:t,required:!0,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-r-lg focus:ring-blue-500 focus:border-blue-500 p-3",placeholder:"50 123 4567"})]})}),e.jsx(g,{label:"Monthly Salary (AED)",children:e.jsx("input",{type:"number",name:"salary",value:r.salary,onChange:t,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})}),e.jsx(g,{label:"Bank Applying",children:e.jsx(F,{id:"bank",name:"bank",value:r.bank,onChange:t,options:J})}),e.jsx(g,{label:"Product Type",children:e.jsx(F,{id:"productType",name:"productType",value:r.productType,onChange:t,options:Z})}),o&&e.jsx(g,{label:"Product",children:e.jsx(F,{id:"product",name:"product",value:r.product,onChange:t,options:_})}),e.jsx(g,{label:"Referral",children:e.jsx("input",{type:"text",name:"referral",value:r.referral,onChange:t,placeholder:"Type name or select from list...",className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})}),e.jsx(g,{label:"Salary getting from (months)",children:e.jsx("input",{type:"number",name:"salaryMonths",value:r.salaryMonths,onChange:t,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})}),e.jsx(g,{label:"Any variations in salary?",children:e.jsxs("select",{name:"salaryVariations",value:r.salaryVariations?"yes":"no",onChange:d=>i(m=>({...m,salaryVariations:d.target.value==="yes"})),className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})}),e.jsx(g,{label:"Already using credit cards?",children:e.jsxs("select",{name:"existingCards",value:r.existingCards?"yes":"no",onChange:d=>i(m=>({...m,existingCards:d.target.value==="yes"})),className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})}),e.jsx(g,{label:"If yes, from how long?",children:e.jsx("input",{type:"text",name:"cardsDuration",value:r.cardsDuration,onChange:t,placeholder:"e.g., 2 years",className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})}),e.jsx(g,{label:"Total credit limit (AED)",children:e.jsx("input",{type:"number",name:"totalCreditLimit",value:r.totalCreditLimit,onChange:t,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})}),e.jsx(g,{label:"Any EMI/Loan paying?",children:e.jsxs("select",{name:"hasEmi",value:r.hasEmi?"yes":"no",onChange:d=>i(m=>({...m,hasEmi:d.target.value==="yes"})),className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})}),e.jsx(g,{label:"Total EMI amount (AED)",children:e.jsx("input",{type:"number",name:"emiAmount",value:r.emiAmount,onChange:t,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})}),e.jsx(g,{label:"Applied same bank/product in last 60 days?",children:e.jsxs("select",{name:"appliedRecently",value:r.appliedRecently?"yes":"no",onChange:d=>i(m=>({...m,appliedRecently:d.target.value==="yes"})),className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:"Documents Available?"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:["Emirates ID","Passport Photo","Salary Certificate","Labor Contract","Payslips"].map(d=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:r.documentsAvailable.includes(d),onChange:m=>{const y=m.target.checked;i(k=>({...k,documentsAvailable:y?[...k.documentsAvailable,d]:k.documentsAvailable.filter(E=>E!==d)}))},className:"rounded border-gray-300 text-blue-600 shadow-sm focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:d})]},d))})]})]})}),e.jsx("footer",{className:"p-4 border-t border-gray-200 flex-shrink-0",children:e.jsx("button",{type:"submit",disabled:b,className:"w-full py-3 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all active:scale-95 shadow disabled:opacity-50",children:b?"Saving...":c==="add"?"Save Lead":"Update Lead"})})]})]})})}const ge=({lead:a,isOpen:s,onClose:p})=>{const{updateLead:j,deleteLead:v}=P(),{showConfirmation:x,addNotification:b}=I(),[l,c]=h.useState({});h.useEffect(()=>{a&&c(a)},[a]);const r=o=>{const{name:n,value:t,type:N}=o.target,f=o.target.checked;c(A=>({...A,[n]:N==="checkbox"?f:N==="number"?t===""?null:Number(t):t}))},i=(o,n)=>{c(t=>({...t,documents_available:n?[...t.documents_available||[],o]:(t.documents_available||[]).filter(N=>N!==o)}))},_=()=>{a&&j.mutate({id:a.id,updates:l},{onSuccess:()=>{b("Lead Updated","Lead details have been saved successfully."),p()},onError:o=>{b("Update Failed",o.message)}})},w=()=>{a&&x("Delete Lead",`Are you sure you want to delete "${a.full_name}"? This action cannot be undone.`,()=>{v.mutate(a.id,{onSuccess:()=>{b("Lead Deleted","Lead has been deleted successfully."),p()},onError:o=>{b("Delete Failed",o.message)}})})};return!s||!a?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Lead Details: ",a.full_name]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:w,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete Lead",children:e.jsx(ne,{className:"w-5 h-5"})}),e.jsx("button",{onClick:p,className:"p-2 text-gray-400 hover:bg-gray-100 rounded-lg transition-colors",title:"Close",children:e.jsx($,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:e.jsxs("form",{className:"space-y-6",children:[e.jsxs("fieldset",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("legend",{className:"text-sm font-semibold text-[#1a68c7] px-2",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Name"}),e.jsx("input",{type:"text",name:"full_name",value:l.full_name||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Company"}),e.jsx("input",{type:"text",name:"company_name",value:l.company_name||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Mobile"}),e.jsx("input",{type:"tel",name:"phone",value:l.phone||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Location"}),e.jsx("input",{type:"text",name:"location",value:l.location||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]})]})]}),e.jsxs("fieldset",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("legend",{className:"text-sm font-semibold text-[#1a68c7] px-2",children:"Product Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Bank Applying"}),e.jsx("input",{type:"text",name:"bank_name",value:l.bank_name||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Product Type"}),e.jsx("input",{type:"text",name:"product_type",value:l.product_type||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Specific Product"}),e.jsx("input",{type:"text",name:"product",value:l.product||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]})]})]}),e.jsxs("fieldset",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("legend",{className:"text-sm font-semibold text-[#1a68c7] px-2",children:"Salary Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Salary (AED)"}),e.jsx("input",{type:"number",name:"monthly_salary",value:l.monthly_salary||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Salary getting from (months)"}),e.jsx("input",{type:"number",name:"salary_months",value:l.salary_months||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Any variations in salary?"}),e.jsxs("select",{name:"salary_variations",value:l.salary_variations?"yes":"no",onChange:o=>c(n=>({...n,salary_variations:o.target.value==="yes"})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"If yes, last 3 months payslips are required to confirm the reason."})]})]})]}),e.jsxs("fieldset",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("legend",{className:"text-sm font-semibold text-[#1a68c7] px-2",children:"Existing Credit & EMI"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Already using credit cards?"}),e.jsxs("select",{name:"existing_cards",value:l.existing_cards?"yes":"no",onChange:o=>c(n=>({...n,existing_cards:o.target.value==="yes"})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"If yes, from how long?"}),e.jsx("input",{type:"text",name:"cards_duration",value:l.cards_duration||"",onChange:r,placeholder:"e.g., 2 years",className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Total credit limit (AED)"}),e.jsx("input",{type:"number",name:"total_credit_limit",value:l.total_credit_limit||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Any EMI/Loan paying?"}),e.jsxs("select",{name:"has_emi",value:l.has_emi?"yes":"no",onChange:o=>c(n=>({...n,has_emi:o.target.value==="yes"})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Total EMI amount (AED)"}),e.jsx("input",{type:"number",name:"emi_amount",value:l.emi_amount||"",onChange:r,className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent"})]})]})]}),e.jsxs("fieldset",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("legend",{className:"text-sm font-semibold text-[#1a68c7] px-2",children:"Application History & Documents"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Applied same bank/product in last 60 days?"}),e.jsxs("select",{name:"applied_recently",value:l.applied_recently?"yes":"no",onChange:o=>c(n=>({...n,applied_recently:o.target.value==="yes"})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1a68c7] focus:border-transparent",children:[e.jsx("option",{value:"no",children:"No"}),e.jsx("option",{value:"yes",children:"Yes"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Documents Available?"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:["Emirates ID","Passport Photo","Salary Certificate","Labor Contract","Payslips"].map(o=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:(l.documents_available||[]).includes(o),onChange:n=>i(o,n.target.checked),className:"rounded border-gray-300 text-[#1a68c7] focus:ring-[#1a68c7]"}),e.jsx("span",{className:"text-sm text-gray-700",children:o})]},o))})]})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:_,className:"px-4 py-2 bg-[#1a68c7] text-white hover:bg-[#1455a6] rounded-lg transition-colors flex items-center space-x-2",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Changes"})]})]})]})})},be=X.memo(({lead:a})=>{const{user:s}=O(),{deleteLead:p,updateLead:j}=P(),{createDeal:v}=G(),{showConfirmation:x,addNotification:b,logActivity:l}=I(),[c,r]=h.useState(!1),i=n=>({appointment_booked:"bg-[#1a68c7] text-white border-[#1a68c7]",warm:"bg-orange-100 text-orange-800 border-orange-500",qualified:"bg-[#74c12d] text-white border-[#74c12d]"})[n||"warm"]||"bg-gray-100 text-gray-800 border-gray-500",_=a.applied_recently,w=()=>{var t;if(!s)return;const n={title:`${a.product||"Deal"} - ${a.full_name}`,amount:a.loan_amount_requested||(a.monthly_salary||0)*3||5e4,stage:"application_processing",client_name:a.full_name,expected_close_date:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],probability:25,product_type:(t=a.product)==null?void 0:t.toLowerCase().replace(/ /g,"_"),user_id:s.id,application_number:`APP-${Math.floor(1e4+Math.random()*9e4)}`,bdi_number:`BDI-${Math.floor(1e4+Math.random()*9e4)}`};v.mutate(n,{onSuccess:()=>{b("Lead Converted",`${a.full_name} is now a deal.`),l("lead_convert",`Converted lead "${a.full_name}" to a deal.`),p.mutate(a.id)},onError:N=>b("Conversion Failed",N.message)})},o=n=>{j.mutate({id:a.id,updates:{qualification_status:n}},{onSuccess:t=>b("Status Updated",`${t.full_name} is now ${n.replace(/_/g," ")}.`),onError:t=>b("Update Failed",t.message)})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`bg-white border rounded-lg hover:shadow-md transition-all border-l-4 ${i(a.qualification_status).split(" ")[3]||"border-gray-500"} p-4`,children:[_&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-2 mb-3 flex items-center space-x-2",children:[e.jsx(pe,{className:"w-4 h-4 text-yellow-600 flex-shrink-0"}),e.jsx("span",{className:"text-xs text-yellow-800",children:"Applied in last 60 days"})]}),e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm flex items-center",title:a.full_name,children:a.full_name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${i(a.qualification_status)}`,children:a.qualification_status==="appointment_booked"?"Appointment":a.qualification_status==="qualified"?"Qualified":"Warm"})]}),e.jsxs("p",{className:"text-xs text-gray-600 flex items-center",children:[e.jsx(D,{className:"w-3 h-3 mr-1 text-gray-400 flex-shrink-0"}),e.jsx("span",{title:a.company_name||"N/A",children:a.company_name||"N/A"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs text-gray-700 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ee,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{children:a.monthly_salary?`${(a.monthly_salary/1e3).toFixed(0)}K AED`:"N/A"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(U,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{children:a.phone?a.phone.replace(/^\+971/,""):"N/A"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ue,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"truncate",title:a.product||"",children:a.product||"N/A"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ce,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"truncate",title:a.location||"",children:a.location||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),a.phone&&(window.location.href=`tel:${a.phone.replace(/\s/g,"")}`)},disabled:!a.phone,className:"p-1.5 hover:bg-[#1a68c7]/10 rounded-md transition-colors",title:"Call",children:e.jsx(U,{className:"w-4 h-4 text-[#1a68c7]"})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),a.phone&&(window.location.href=`https://wa.me/${a.phone.replace(/\s/g,"")}`)},disabled:!a.phone,className:"p-1.5 hover:bg-[#74c12d]/10 rounded-md transition-colors",title:"WhatsApp",children:e.jsx(me,{className:"w-4 h-4 text-[#74c12d]"})}),e.jsx("button",{onClick:()=>r(!0),className:"p-1.5 hover:bg-gray-100 rounded-md transition-colors",title:"View Details",children:e.jsx(se,{className:"w-4 h-4 text-gray-500"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{defaultValue:a.qualification_status||"warm",onChange:n=>{const t=n.target.value;t==="convert"?x("Convert to Deal?",`This will create a new deal for "${a.full_name}" and remove this lead. Are you sure?`,w):o(t),n.target.value=a.qualification_status||"warm"},className:`appearance-none text-xs font-medium px-2 py-1 rounded border ${i(a.qualification_status)} focus:outline-none focus:ring-2 focus:ring-[#1a68c7]/20`,children:[e.jsx("option",{value:"warm",children:"Warm"}),e.jsx("option",{value:"qualified",children:"Qualified"}),e.jsx("option",{value:"appointment_booked",children:"Appointment"})]}),e.jsx(V,{className:"w-3 h-3 text-current pointer-events-none"}),e.jsx("button",{onClick:()=>{x("Convert to Deal?",`This will create a new deal for "${a.full_name}" and remove this lead. Are you sure?`,w)},className:"px-3 py-1 bg-[#74c12d] text-white text-xs font-medium rounded hover:bg-[#62a821] transition-colors",children:"To Deal"})]})]})]}),e.jsx(ge,{lead:a,isOpen:c,onClose:()=>r(!1)})]})});function ye({isOpen:a,onClose:s,filters:p,setFilters:j,onApply:v,onClear:x}){if(!a)return null;const b=l=>{const{value:c,checked:r}=l.target;j(i=>{const _=r?[...i.products,c]:i.products.filter(w=>w!==c);return{...i,products:_}})};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex justify-center items-end animate-fade-in",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-t-2xl shadow-xl p-6 transform transition-transform animate-slide-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Filter Leads"}),e.jsx("button",{onClick:s,className:"p-2 -mr-2 rounded-full hover:bg-gray-100",children:e.jsx($,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"space-y-6 overflow-y-auto max-h-[60vh] pr-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Urgency"}),e.jsx("div",{className:"flex space-x-2 bg-gray-100 p-1 rounded-lg mt-2",children:["all","high","medium","low"].map(l=>e.jsx("button",{onClick:()=>j(c=>({...c,urgency:l})),className:`flex-1 py-2 px-3 text-xs font-medium rounded-md transition-all ${p.urgency===l?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:l.charAt(0).toUpperCase()+l.slice(1)},l))})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"salary",className:"text-sm font-medium text-gray-700 flex justify-between",children:[e.jsx("span",{children:"Minimum Monthly Salary (AED)"}),e.jsxs("span",{className:"font-bold text-blue-600",children:[(p.salaryRange[0]/1e3).toFixed(0),"K"]})]}),e.jsx("input",{id:"salary",type:"range",min:"0",max:"100000",step:"5000",value:p.salaryRange[0],onChange:l=>j(c=>({...c,salaryRange:[parseInt(l.target.value),1e5]})),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-2 accent-blue-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Interest"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mt-2",children:re.map(l=>e.jsxs("label",{className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",value:l.key,checked:p.products.includes(l.key),onChange:b,className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-800 capitalize",children:l.name})]},l.key))})]})]}),e.jsxs("div",{className:"mt-8 flex space-x-3",children:[e.jsx("button",{onClick:x,className:"flex-1 py-3 px-4 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-all active:scale-95",children:"Clear All"}),e.jsx("button",{onClick:v,className:"flex-1 py-3 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all active:scale-95 shadow",children:"Apply Filters"})]})]})})}function ke(){var E;const{setTitle:a}=I();h.useEffect(()=>{a("Leads")},[a]);const s=ae(),{leads:p,isLoading:j}=P(),[v,x]=h.useState(((E=s.state)==null?void 0:E.showAddModal)||!1),[b,l]=h.useState(null),[c,r]=h.useState(""),[i,_]=h.useState("all"),[w,o]=h.useState(!1),n={urgency:"all",salaryRange:[0,1e5],products:[]},[t,N]=h.useState(n),[f,A]=h.useState(n),S=h.useMemo(()=>JSON.stringify(f)!==JSON.stringify(n),[f]);h.useEffect(()=>{var u;(u=s.state)!=null&&u.showAddModal&&x(!0)},[s.state]);const M=()=>{N(f),o(!0)},d=()=>{A(t),o(!1)},m=()=>{N(n)},y=h.useMemo(()=>p?p.filter(u=>{var q;const B=c===""||u.full_name.toLowerCase().includes(c.toLowerCase())||((q=u.company_name)==null?void 0:q.toLowerCase().includes(c.toLowerCase()))||u.phone.includes(c),Y=i==="all"||u.qualification_status===i,z=f.urgency==="all"||u.urgency_level===f.urgency,H=(u.monthly_salary||0)>=f.salaryRange[0],Q=f.products.length===0||f.products.some(K=>{var R;return(R=u.product_interest)==null?void 0:R.includes(K)});return B&&Y&&z&&H&&Q}):[],[c,i,f,p]);if(j)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm",children:[e.jsx(C,{className:"h-10 w-full"}),e.jsxs("div",{className:"flex space-x-1 mt-4",children:[e.jsx(C,{className:"h-10 flex-1"}),e.jsx(C,{className:"h-10 flex-1"}),e.jsx(C,{className:"h-10 flex-1"}),e.jsx(C,{className:"h-10 flex-1"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{className:"h-40 rounded-xl"}),e.jsx(C,{className:"h-40 rounded-xl"}),e.jsx(C,{className:"h-40 rounded-xl"})]})]});const k=()=>{x(!1),l(null)};return e.jsxs("div",{className:"relative pb-20",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border shadow-sm",children:[e.jsxs("div",{className:"flex space-x-2 mb-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search leads...",value:c,onChange:u=>r(u.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]}),e.jsxs("button",{onClick:M,className:"relative p-2 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(ie,{className:`w-4 h-4 transition-colors ${S?"text-blue-600":"text-gray-600"}`}),S&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-blue-600 rounded-full border-2 border-white"})]})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:["all","warm","qualified","appointment_booked"].map(u=>e.jsx("button",{onClick:()=>_(u),className:`flex-1 py-2 px-3 text-xs font-medium rounded-md transition-all ${i===u?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:u==="appointment_booked"?"Appointment":u.charAt(0).toUpperCase()+u.slice(1)},u))})]}),e.jsx("div",{className:"space-y-4",children:y.length>0?y.map(u=>e.jsx(be,{lead:u},u.id)):e.jsx(te,{icon:e.jsx(le,{className:"w-12 h-12 text-gray-300"}),title:"No Leads Found",message:"Try adjusting your search or filters, or add a new lead."})})]}),e.jsx("button",{onClick:()=>{l(null),x(!0)},className:"fixed bottom-20 right-5 z-30 w-14 h-14 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-blue-700 transition-all active:scale-90","aria-label":"Add new lead",children:e.jsx(de,{className:"w-7 h-7"})}),(v||b)&&e.jsx(he,{onClose:k,initialData:b}),e.jsx(ye,{isOpen:w,onClose:()=>o(!1),filters:t,setFilters:N,onApply:d,onClear:m})]})}export{ke as default};
