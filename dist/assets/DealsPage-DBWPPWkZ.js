import{R,j as e,m as $,B as P,d as O,r as u,e as U,u as z,a as V,E as L,X as W,D as M,K,l as H,P as Q}from"./index-NvUe1ZN8.js";import{S}from"./SkeletonLoader-DxXA5r8T.js";import{I as Y}from"./info-DOZ6-6U3.js";import{P as G,S as X}from"./search-CeK9lVvl.js";import{M as J}from"./mail-BRfvtj-5.js";import{P as Z}from"./plus-DOf-Dc6j.js";import{T as ee,H as B}from"./trending-up-BF-H8HXi.js";import{C as D}from"./calendar-CvnRJtis.js";import{C as q}from"./chevron-down-BbxtYO4C.js";import{P as le}from"./pen-line-Dgv-gfwV.js";const se=s=>s?s.split(" ").map(o=>o[0]).slice(0,2).join("").toUpperCase():"?",ae=({name:s})=>{const o=se(s),l=p=>{let t=0;for(let m=0;m<p.length;m++)t=p.charCodeAt(m)+((t<<5)-t);return t},i=["bg-blue-100 text-blue-800","bg-purple-100 text-purple-800","bg-green-100 text-green-800","bg-yellow-100 text-yellow-800","bg-red-100 text-red-800","bg-indigo-100 text-indigo-800"],x=i[Math.abs(l(s))%i.length];return e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm ${x} flex-shrink-0`,children:o})},te=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.586-1.456l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.269.654 4.495 1.932 6.22l-1.023 3.744 3.845-1.004zm-3.837 1.387l.494.296c1.695 1.011 3.58 1.574 5.63 1.576 6.245 0 11.33-5.084 11.332-11.33.001-6.247-5.085-11.332-11.334-11.332-6.245 0-11.331 5.085-11.333 11.331.001 2.431.792 4.78 2.215 6.64l.43.586-1.24 4.545 4.66-1.219z"})}),re=R.memo(({deal:s,onView:o})=>{const l=(t,m)=>{t.stopPropagation(),m()},i=()=>{s.mobile_number&&(window.location.href=`tel:${s.mobile_number.replace(/\s/g,"")}`)},x=()=>{s.email_address&&(window.location.href=`mailto:${s.email_address}`)},p=()=>{if(s.whatsapp_number){const t=s.whatsapp_number.replace(/[^0-9]/g,"");window.open(`https://wa.me/${t}`,"_blank")}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-3 border border-gray-200 hover:shadow-md hover:-translate-y-0.5 transition-all duration-200 active:scale-98",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(ae,{name:s.client_name}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-gray-900 truncate",title:s.client_name,children:s.client_name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",title:s.company_name||"N/A",children:s.company_name||"No Company"})]})]}),e.jsx("button",{onClick:t=>l(t,()=>o(s)),className:"p-1 -mr-1 rounded-full hover:bg-gray-100",children:e.jsx(Y,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700 my-3 border-t border-gray-100 pt-3",children:[e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx($,{className:"w-3.5 h-3.5 mr-2 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:s.bank_applying||"",children:s.bank_applying||"N/A"})]}),e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx(P,{className:"w-3.5 h-3.5 mr-2 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:s.product||"",children:s.product||"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsxs("button",{onClick:t=>l(t,i),disabled:!s.mobile_number,className:"flex items-center justify-center py-2 px-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-xs font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(G,{className:"w-3.5 h-3.5 mr-1.5"})," Call"]}),e.jsxs("button",{onClick:t=>l(t,p),disabled:!s.whatsapp_number,className:"flex items-center justify-center py-2 px-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-xs font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(te,{})," ",e.jsx("span",{className:"ml-1.5",children:"WhatsApp"})]}),e.jsxs("button",{onClick:t=>l(t,x),disabled:!s.email_address,className:"flex items-center justify-center py-2 px-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-xs font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(J,{className:"w-3.5 h-3.5 mr-1.5"})," Email"]})]})]})}),ne=({stage:s,deals:o,onViewDeal:l,onEditDeal:i,onDeleteDeal:x})=>{const p={blue:"bg-blue-100 text-blue-800 border-blue-200",yellow:"bg-yellow-100 text-yellow-800 border-yellow-200",purple:"bg-purple-100 text-purple-800 border-purple-200",green:"bg-green-100 text-green-800 border-green-200",red:"bg-red-100 text-red-800 border-red-200"};return e.jsxs("div",{className:"flex-shrink-0 w-[calc(100vw-3rem)] sm:w-80 h-full flex flex-col snap-center border rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:`${p[s.color]} p-3`,children:[e.jsx("h3",{className:"font-semibold text-sm",children:s.label}),e.jsxs("p",{className:"text-xs mt-1",children:[o.length," deals"]})]}),e.jsx("div",{className:"space-y-3 overflow-y-auto flex-grow p-3 bg-gray-50",children:o.map(t=>e.jsx(re,{deal:t,onView:l,onEdit:i,onDelete:x},t.id))})]})},T={title:"",client_name:"",company_name:"",designation:"",monthly_salary:"",bank_applying:"Emirates Islamic Bank",product_type:"Credit Card",product:L[0].name,mobile_number:"",email_address:"",whatsapp_number:"",amount:"",stage:"application_processing",expected_close_date:new Date().toISOString().split("T")[0],completed_date:"",application_number:"",bdi_number:"",aecb_score:""},F=K.map(s=>({value:s.id,label:s.title})),b=({icon:s,label:o,value:l})=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-gray-100 p-2 rounded-lg mt-1",children:e.jsx(s,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:o}),e.jsx("p",{className:"font-medium text-gray-800",children:l||"N/A"})]})]}),A=({title:s,children:o})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:col-span-2 mt-4 first:mt-0",children:e.jsx("h3",{className:"text-base font-semibold text-gray-800 border-b pb-2",children:s})}),o]}),c=({label:s,children:o,required:l})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s,l&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),o]}),k=({id:s,name:o,value:l,onChange:i,options:x,required:p})=>e.jsxs("div",{className:"relative",children:[e.jsx("select",{id:s,name:o,value:l,onChange:i,required:p,className:"w-full appearance-none bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-3 pr-10",children:x.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx(q,{className:"w-4 h-4 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none"})]});function oe({isOpen:s,onClose:o,initialData:l,initialMode:i="view"}){var C;const{createDeal:x,updateDeal:p}=U(),{user:t}=V(),{addNotification:m}=O(),[j,v]=u.useState(l?i:"edit"),[a,w]=u.useState(T),[_,h]=u.useState(!1),[N,E]=u.useState(L.map(r=>r.name));u.useEffect(()=>{let r=[];a.bank_applying==="Emirates Islamic Bank"&&a.product_type==="Credit Card"?r=L.map(g=>g.name):a.product_type==="Account Opening"&&(r=["Personal Account","Business Account"]),E(r),r.includes(a.product)||w(g=>({...g,product:r[0]||""}))},[a.bank_applying,a.product_type,a.product]),u.useEffect(()=>{var r;l?(w({title:l.title||"",client_name:l.client_name||"",amount:String(l.amount||""),stage:l.stage||"application_processing",expected_close_date:l.expected_close_date?l.expected_close_date.split("T")[0]:new Date().toISOString().split("T")[0],completed_date:l.completed_date?l.completed_date.split("T")[0]:"",application_number:l.application_number||"",bdi_number:l.bdi_number||"",company_name:l.company_name||"",designation:l.designation||"",monthly_salary:String(l.monthly_salary||""),bank_applying:l.bank_applying||"Emirates Islamic Bank",product_type:l.product_type||"Credit Card",product:l.product||"",mobile_number:((r=l.mobile_number)==null?void 0:r.replace("+971","").trim())||"",email_address:l.email_address||"",whatsapp_number:l.whatsapp_number||"",aecb_score:String(l.aecb_score||"")}),v(i)):(w(T),v("edit"))},[l,i,s]);const d=r=>{const{name:g,value:f}=r.target;w(n=>{const y={...n,[g]:f};return g==="product_type"&&f==="Credit Card"&&(y.amount=""),y})},I=r=>{if(r.preventDefault(),!t){m("Authentication Error","You must be logged in.");return}h(!0);const g={...a,user_id:t.id,amount:parseInt(a.amount,10)||0,monthly_salary:parseInt(a.monthly_salary,10)||null,mobile_number:a.mobile_number?`+971 ${a.mobile_number}`:null,completed_date:a.stage==="completed"&&a.completed_date||null,aecb_score:a.aecb_score?parseInt(a.aecb_score,10):null};l?p.mutate({id:l.id,updates:g},{onSuccess:()=>{m("Deal Updated",`${a.title} has been saved.`),o()},onError:f=>m("Error",f.message),onSettled:()=>h(!1)}):x.mutate(g,{onSuccess:()=>{m("Deal Created",`${a.title} has been saved.`),o()},onError:f=>m("Error",f.message),onSettled:()=>h(!1)})};return s?e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex justify-center items-end animate-fade-in sm:items-center",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-t-2xl sm:rounded-xl shadow-xl flex flex-col max-h-[90vh] animate-slide-up",children:[e.jsxs("header",{className:"flex items-center justify-between p-4 border-b flex-shrink-0",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:j==="edit"?l?"Edit Deal":"Add New Deal":(l==null?void 0:l.title)||"Deal Details"}),e.jsx("button",{onClick:o,className:"p-2 -mr-2 rounded-full hover:bg-gray-100",children:e.jsx(W,{className:"w-5 h-5 text-gray-600"})})]}),j==="view"&&l?e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:"flex-1 p-6 overflow-y-auto space-y-4",children:[e.jsx(b,{icon:P,label:"Client",value:l.client_name}),l.product_type!=="Credit Card"&&e.jsx(b,{icon:M,label:"Amount",value:`AED ${l.amount.toLocaleString()}`}),e.jsx(b,{icon:$,label:"Company",value:l.company_name}),e.jsx(b,{icon:P,label:"Designation",value:l.designation}),e.jsx(b,{icon:M,label:"Salary",value:l.monthly_salary?`AED ${l.monthly_salary.toLocaleString()}`:null}),e.jsx(b,{icon:ee,label:"AECB Score",value:l.aecb_score}),e.jsx(b,{icon:D,label:"Submission Date",value:new Date(l.created_at||"").toLocaleDateString()}),l.stage==="completed"?e.jsx(b,{icon:D,label:"Completed Date",value:l.completed_date?new Date(l.completed_date).toLocaleDateString():"N/A"}):e.jsx(b,{icon:D,label:"Expected Close",value:l.expected_close_date?new Date(l.expected_close_date).toLocaleDateString():null}),e.jsx(b,{icon:B,label:"Application No.",value:l.application_number}),e.jsx(b,{icon:B,label:"BDI No.",value:l.bdi_number}),e.jsx(b,{icon:q,label:"Stage",value:((C=F.find(r=>r.value===l.stage))==null?void 0:C.label)||"N/A"})]}),e.jsx("footer",{className:"p-4 bg-gray-50 border-t flex-shrink-0",children:e.jsxs("button",{onClick:()=>v("edit"),className:"w-full py-3 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all active:scale-95 shadow flex items-center justify-center",children:[e.jsx(le,{className:"w-4 h-4 mr-2"})," Edit Deal"]})})]}):e.jsxs("form",{onSubmit:I,className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("main",{className:"flex-1 p-6 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsx(A,{title:"Application Details",children:e.jsxs(e.Fragment,{children:[e.jsx(c,{label:"Application Number",children:e.jsx("input",{type:"text",name:"application_number",value:a.application_number,onChange:d,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(c,{label:"BPM ID",children:e.jsx("input",{type:"text",name:"bdi_number",value:a.bdi_number,onChange:d,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(c,{label:"Status / Stage",children:e.jsx(k,{id:"stage",name:"stage",value:a.stage||"application_processing",onChange:d,options:F})}),a.stage==="completed"?e.jsx(c,{label:"Completed Date",required:!0,children:e.jsx("input",{type:"date",name:"completed_date",value:a.completed_date,onChange:d,max:new Date().toISOString().split("T")[0],required:!0,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}):e.jsx(c,{label:"Expected Close Date",children:e.jsx("input",{type:"date",name:"expected_close_date",value:a.expected_close_date,onChange:d,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})})]})}),e.jsx(A,{title:"Client Information",children:e.jsxs(e.Fragment,{children:[e.jsx(c,{label:"Full Name",required:!0,children:e.jsx("input",{type:"text",name:"client_name",value:a.client_name,onChange:d,required:!0,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(c,{label:"Company Name",children:e.jsx("input",{type:"text",name:"company_name",value:a.company_name,onChange:d,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(c,{label:"Designation",children:e.jsx("input",{type:"text",name:"designation",value:a.designation,onChange:d,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(c,{label:"Monthly Salary (AED)",children:e.jsx("input",{type:"number",name:"monthly_salary",value:a.monthly_salary,onChange:d,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(c,{label:"AECB Score",children:e.jsx("input",{type:"number",name:"aecb_score",value:a.aecb_score,onChange:d,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})})]})}),e.jsx(A,{title:"Product Details",children:e.jsxs(e.Fragment,{children:[e.jsx(c,{label:"Bank Applying",children:e.jsx(k,{id:"bank_applying",name:"bank_applying",value:a.bank_applying,onChange:d,options:H.map(r=>({value:r,label:r}))})}),e.jsx(c,{label:"Product Type",children:e.jsx(k,{id:"product_type",name:"product_type",value:a.product_type,onChange:d,options:Q.map(r=>({value:r,label:r}))})}),N.length>0&&e.jsx(c,{label:"Product",children:e.jsx(k,{id:"product",name:"product",value:a.product,onChange:d,options:N.map(r=>({value:r,label:r}))})}),a.product_type!=="Credit Card"&&e.jsx(c,{label:"Amount (AED)",required:!0,children:e.jsx("input",{type:"number",name:"amount",value:a.amount,onChange:d,required:!0,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})})]})}),e.jsx(A,{title:"Contact Information",children:e.jsxs(e.Fragment,{children:[e.jsx(c,{label:"Mobile Number",children:e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"inline-flex items-center px-3 text-sm text-gray-900 bg-gray-50 border border-r-0 border-gray-300 rounded-l-lg",children:"+971"}),e.jsx("input",{type:"tel",name:"mobile_number",value:a.mobile_number,onChange:d,className:"w-full bg-white border border-gray-300 p-3 rounded-r-lg",placeholder:"50 123 4567"})]})}),e.jsx(c,{label:"Email Address",children:e.jsx("input",{type:"email",name:"email_address",value:a.email_address,onChange:d,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(c,{label:"WhatsApp Number",children:e.jsx("input",{type:"text",name:"whatsapp_number",value:a.whatsapp_number,onChange:d,className:"w-full bg-white border border-gray-300 p-3 rounded-lg",placeholder:"+9715..."})})]})})]}),e.jsx("footer",{className:"p-4 bg-gray-50 border-t flex-shrink-0",children:e.jsx("button",{type:"submit",disabled:_,className:"w-full py-3 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all active:scale-95 shadow disabled:opacity-50",children:_?"Saving...":l?"Update Deal":"Save Deal"})})]})]})}):null}function fe(){const{showConfirmation:s,addNotification:o,setTitle:l}=O();u.useEffect(()=>{l("Deals")},[l]);const{deals:i,isLoading:x,deleteDeal:p}=U(),t=z(),[m,j]=u.useState(!1),[v,a]=u.useState(null),[w,_]=u.useState("view"),[h,N]=u.useState(""),E=[{id:"application_processing",label:"Application Processing",color:"blue"},{id:"verification_needed",label:"Verification Needed",color:"yellow"},{id:"activation_needed",label:"Activation Needed",color:"purple"},{id:"completed",label:"Completed",color:"green"},{id:"unsuccessful",label:"Unsuccessful",color:"red"}],d=u.useMemo(()=>i?i.filter(n=>!h||n.client_name.toLowerCase().includes(h.toLowerCase())||n.title.toLowerCase().includes(h.toLowerCase())||n.company_name&&n.company_name.toLowerCase().includes(h.toLowerCase())||n.application_number&&n.application_number.toLowerCase().includes(h.toLowerCase())):[],[h,i]),I=n=>{a(n),_("view"),j(!0)},C=n=>{a(n),_("edit"),j(!0)},r=u.useCallback(()=>{a(null),_("edit"),j(!0)},[]);u.useEffect(()=>{var n;(n=t.state)!=null&&n.showAddModal&&(r(),window.history.replaceState({},document.title))},[t.state,r]);const g=n=>{s("Delete Deal?",`Are you sure you want to permanently delete the deal "${n.title}"? This action cannot be undone.`,()=>{p.mutate(n.id,{onSuccess:()=>o("Deal Deleted","The deal has been successfully removed."),onError:y=>o("Error",y.message||"Failed to delete deal.")})})},f=()=>{j(!1),a(null)};return x?e.jsxs("div",{className:"relative flex flex-col h-[calc(100vh-148px)] lg:h-[calc(100vh-110px)]",children:[e.jsx("div",{className:"p-4 bg-gray-50 border-b flex-shrink-0",children:e.jsx(S,{className:"h-10 w-full rounded-lg"})}),e.jsx("div",{className:"flex-grow overflow-x-auto kanban-board",children:e.jsx("div",{className:"flex space-x-4 p-4 h-full",children:[...Array(3)].map((n,y)=>e.jsxs("div",{className:"flex-shrink-0 w-[calc(100vw-3rem)] sm:w-80 h-full flex flex-col",children:[e.jsx(S,{className:"h-16 w-full rounded-t-xl"}),e.jsxs("div",{className:"space-y-3 p-3 bg-gray-50 flex-grow rounded-b-xl border",children:[e.jsx(S,{className:"h-32 w-full rounded-lg"}),e.jsx(S,{className:"h-32 w-full rounded-lg"})]})]},y))})})]}):e.jsxs("div",{className:"relative flex flex-col h-[calc(100vh-148px)] lg:h-[calc(100vh-110px)]",children:[e.jsx("div",{className:"p-4 bg-gray-50 border-b flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search deals by client, title, company...",value:h,onChange:n=>N(n.target.value),className:"w-full pl-10 pr-4 py-2 border bg-white border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})}),e.jsx("div",{className:"flex-grow overflow-x-auto kanban-board bg-gray-50",children:e.jsx("div",{className:"flex space-x-4 p-4 h-full",children:E.map(n=>e.jsx(ne,{stage:n,deals:d.filter(y=>y.stage===n.id),onViewDeal:I,onEditDeal:C,onDeleteDeal:g},n.id))})}),e.jsx("button",{onClick:r,className:"fixed bottom-20 right-5 z-30 w-14 h-14 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-blue-700 transition-all active:scale-90","aria-label":"Add new deal",children:e.jsx(Z,{className:"w-7 h-7"})}),m&&e.jsx(oe,{isOpen:m,onClose:f,initialData:v,initialMode:w})]})}export{fe as default};
