import{c as E,R as A,f as C,d as S,j as e,a as L,r as u,X as M,u as I,L as U}from"./index-NvUe1ZN8.js";import{D as $,a as k}from"./DropdownMenu--EYT8ldO.js";import{C as P}from"./circle-check-big-FIADmbi3.js";import{P as F}from"./pen-line-Dgv-gfwV.js";import{T as O}from"./trash-2-GHgWQrqY.js";import{E as R}from"./ellipsis-vertical-CjIRcmky.js";import{C as V}from"./calendar-CvnRJtis.js";import{C as q}from"./clock-BVYeTL-p.js";import{C as z}from"./chevron-down-BbxtYO4C.js";import{E as B}from"./EmptyState-DD9JB5rK.js";import{S as f}from"./SkeletonLoader-DxXA5r8T.js";import{P as G}from"./plus-DOf-Dc6j.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=E("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),X=A.memo(({task:t,onEdit:s})=>{const{toggleTaskComplete:m,deleteTask:x}=C(),{showConfirmation:p,addNotification:o}=S(),n={urgent:"border-red-300",high:"border-orange-300",medium:"border-yellow-300",low:"border-green-300"},c={urgent:"bg-red-100 text-red-700",high:"bg-orange-100 text-orange-700",medium:"bg-yellow-100 text-yellow-700",low:"bg-green-100 text-green-700"},d={call:"ðŸ“ž",meeting:"ðŸ‘¥",documentation:"ðŸ“„",verification:"âœ“",follow_up:"ðŸ”„"},r=new Date().toISOString().split("T")[0],g=t.due_date<r&&t.status==="pending",a=new Date(t.due_date).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),y=()=>{p("Delete Task?","Are you sure you want to delete this task? This action cannot be undone.",()=>{x.mutate(t.id,{onSuccess:()=>o("Task Deleted",`"${t.title}" has been removed.`),onError:i=>o("Error",i.message||"Failed to delete task.")})})};return e.jsx("div",{className:`bg-white rounded-xl shadow-sm p-4 border-l-4 ${n[t.priority||"low"]}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("button",{onClick:()=>m.mutate({id:t.id,status:t.status}),className:"mt-1 flex-shrink-0",children:t.status==="completed"?e.jsx(P,{className:"w-6 h-6 text-green-600"}):e.jsx(H,{className:"w-6 h-6 text-gray-400 hover:text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("h3",{className:`font-semibold text-gray-800 break-words pr-2 ${t.status==="completed"?"line-through text-gray-500":""}`,children:[d[t.type||"call"]," ",t.title]}),e.jsx($,{trigger:e.jsx(R,{className:"w-4 h-4 text-gray-500"}),children:e.jsxs(e.Fragment,{children:[e.jsx(k,{onClick:i=>{i.stopPropagation(),s(t)},icon:e.jsx(F,{className:"w-4 h-4 mr-2"}),children:"Edit"}),e.jsx(k,{onClick:i=>{i.stopPropagation(),y()},icon:e.jsx(O,{className:"w-4 h-4 mr-2"}),className:"text-red-600",children:"Delete"})]})})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 break-words",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[e.jsxs("div",{className:`flex items-center space-x-1 text-xs px-2 py-1 rounded ${g?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:[e.jsx(V,{className:"w-3 h-3"}),e.jsx("span",{children:a}),g&&e.jsx("span",{className:"font-semibold ml-1",children:"OVERDUE"})]}),t.time&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded",children:[e.jsx(q,{className:"w-3 h-3"}),e.jsx("span",{children:t.time})]}),t.priority&&e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${c[t.priority]}`,children:t.priority.toUpperCase()})]})]})]})})}),h=({label:t,children:s})=>e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:t}),s]}),w=({id:t,name:s,value:m,onChange:x,options:p,required:o})=>e.jsxs("div",{className:"relative",children:[e.jsx("select",{id:t,name:s,value:m,onChange:x,required:o,className:"w-full appearance-none bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-3 pr-10",children:p.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))}),e.jsx(z,{className:"w-4 h-4 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none"})]});function Y({onClose:t,initialData:s}){const{createTask:m,updateTask:x}=C(),{user:p}=L(),{addNotification:o}=S(),[n,c]=u.useState(!1),d=s?"edit":"add",[r,g]=u.useState({title:(s==null?void 0:s.title)||"",description:(s==null?void 0:s.description)||"",type:(s==null?void 0:s.type)||"call",priority:(s==null?void 0:s.priority)||"medium",due_date:s!=null&&s.due_date?s.due_date.split("T")[0]:new Date().toISOString().split("T")[0],time:(s==null?void 0:s.time)||"",related_to_type:(s==null?void 0:s.related_to_type)||"",related_to_id:(s==null?void 0:s.related_to_id)||""}),a=l=>{const{name:b,value:j}=l.target;g(T=>({...T,[b]:j}))},y=async l=>{if(l.preventDefault(),!p){o("Authentication Error","You must be logged in.");return}c(!0);const b={title:r.title,description:r.description,type:r.type,priority:r.priority,due_date:r.due_date,time:r.time||null,related_to_id:r.related_to_id||null,related_to_type:r.related_to_type||null,user_id:p.id};if(d==="add"){const j={...b,status:"pending"};m.mutate(j,{onSuccess:()=>{o("Task Created",`"${r.title}" has been added.`),t()},onError:T=>o("Error",T.message),onSettled:()=>c(!1)})}else s&&x.mutate({id:s.id,updates:b},{onSuccess:()=>{o("Task Updated",`"${r.title}" has been saved.`),t()},onError:j=>o("Error",j.message),onSettled:()=>c(!1)})},i=[{value:"call",label:"ðŸ“ž Call"},{value:"meeting",label:"ðŸ‘¥ Meeting"},{value:"documentation",label:"ðŸ“„ Documentation"},{value:"verification",label:"âœ“ Verification"},{value:"follow_up",label:"ðŸ”„ Follow Up"}],v=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"urgent",label:"Urgent"}],N=[{value:"",label:"None"},{value:"lead",label:"Lead"},{value:"client",label:"Client"},{value:"deal",label:"Deal"}],_=()=>[];return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex justify-center items-end animate-fade-in sm:items-center",children:e.jsxs("div",{className:"bg-white w-full max-w-md rounded-t-2xl sm:rounded-2xl shadow-xl transform transition-transform animate-slide-up flex flex-col max-h-[90vh]",children:[e.jsxs("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 flex-shrink-0",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:d==="add"?"Add New Task":"Edit Task"}),e.jsx("button",{onClick:t,className:"p-2 -mr-2 rounded-full hover:bg-gray-100",children:e.jsx(M,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("form",{onSubmit:y,className:"flex-1 flex flex-col min-h-0",children:[e.jsx("main",{className:"flex-1 p-6 overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{label:"Task Title*",children:e.jsx("input",{type:"text",name:"title",value:r.title,onChange:a,required:!0,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})}),e.jsx(h,{label:"Description",children:e.jsx("textarea",{name:"description",value:r.description,onChange:a,rows:3,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})}),e.jsx(h,{label:"Task Type",children:e.jsx(w,{id:"type",name:"type",value:r.type,onChange:a,options:i})}),e.jsx(h,{label:"Priority",children:e.jsx(w,{id:"priority",name:"priority",value:r.priority,onChange:a,options:v})}),e.jsx(h,{label:"Related To",children:e.jsx(w,{id:"related_to_type",name:"related_to_type",value:r.related_to_type,onChange:a,options:N})}),r.related_to_type&&e.jsx(h,{label:`${r.related_to_type.charAt(0).toUpperCase()+r.related_to_type.slice(1)} Name`,children:e.jsx(w,{id:"related_to_id",name:"related_to_id",value:r.related_to_id,onChange:a,options:_()})}),e.jsx(h,{label:"Due Date*",children:e.jsx("input",{type:"date",name:"due_date",value:r.due_date,onChange:a,required:!0,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})}),e.jsx(h,{label:"Time (Optional)",children:e.jsx("input",{type:"time",name:"time",value:r.time,onChange:a,className:"w-full bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-3"})})]})}),e.jsx("footer",{className:"p-4 border-t border-gray-200 flex-shrink-0",children:e.jsx("button",{type:"submit",disabled:n,className:"w-full py-3 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all active:scale-95 shadow disabled:opacity-50",children:n?"Saving...":d==="add"?"Save Task":"Update Task"})})]})]})})}function ae(){const{tasks:t,isLoading:s}=C(),{setTitle:m}=S(),x=I(),[p,o]=u.useState(!1),[n,c]=u.useState(null),[d,r]=u.useState("all");u.useEffect(()=>{m("Tasks")},[m]),u.useEffect(()=>{var l;(l=x.state)!=null&&l.showAddModal&&o(!0)},[x.state]);const g=new Date().toISOString().split("T")[0],a=u.useMemo(()=>t.filter(l=>d==="today"?l.due_date===g:d==="pending"?l.status==="pending":d==="completed"?l.status==="completed":!0),[t,d,g]),y=u.useMemo(()=>[...a].sort((l,b)=>l.status!==b.status?l.status==="pending"?-1:1:new Date(l.due_date).getTime()-new Date(b.due_date).getTime()),[a]);if(s)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border shadow-sm",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(f,{className:"h-10 flex-1"}),e.jsx(f,{className:"h-10 flex-1"}),e.jsx(f,{className:"h-10 flex-1"}),e.jsx(f,{className:"h-10 flex-1"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(f,{className:"h-28 rounded-xl"}),e.jsx(f,{className:"h-28 rounded-xl"}),e.jsx(f,{className:"h-28 rounded-xl"})]})]});const i=l=>{c(l),o(!0)},v=()=>{o(!1),c(null)},N=()=>{c(null),o(!0)},_=["all","today","pending","completed"];return e.jsxs("div",{className:"relative pb-20",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl border shadow-sm",children:e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:_.map(l=>e.jsx("button",{onClick:()=>r(l),className:`flex-1 py-2 px-3 text-xs font-medium rounded-md transition-all ${d===l?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:l.charAt(0).toUpperCase()+l.slice(1)},l))})}),e.jsx("div",{className:"space-y-3",children:y.length>0?y.map(l=>e.jsx(X,{task:l,onEdit:i},l.id)):e.jsx(B,{icon:e.jsx(U,{className:"w-12 h-12 text-gray-300"}),title:"No Tasks Found",message:d==="all"?"Add your first task to get started.":"Try adjusting your filter."})})]}),e.jsx("button",{onClick:N,className:"fixed bottom-20 right-5 z-30 w-14 h-14 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-blue-700 transition-all active:scale-90","aria-label":"Add new task",children:e.jsx(G,{className:"w-7 h-7"})}),p&&e.jsx(Y,{onClose:v,initialData:n})]})}export{ae as default};
