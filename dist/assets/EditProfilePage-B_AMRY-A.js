import{c as A,a as P,d as k,b as F,r as o,j as e,U as E,s as y}from"./index-NvUe1ZN8.js";import{u as D}from"./useUserProfile-BbtWJfP5.js";import{S as r}from"./SkeletonLoader-DxXA5r8T.js";import{A as L}from"./arrow-left-6ZvnDfJL.js";import{C as R}from"./circle-check-big-FIADmbi3.js";import"./userService-B1WNrPKI.js";/**
 * @license lucide-react v0.417.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=A("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function K(){const{user:u}=P(),{profile:a,updateProfile:v,isLoading:N}=D(),{addNotification:d}=k(),p=F(),[t,x]=o.useState({full_name:"",designation:"",phone:"",whatsapp_number:"",company_name:"",bio:""}),[c,w]=o.useState(null),[h,f]=o.useState(null),[g,m]=o.useState(!1),b=o.useRef(null);o.useEffect(()=>{var s,l;a&&(x({full_name:a.full_name||"",designation:a.designation||"",phone:((s=a.phone)==null?void 0:s.replace("+971","").trim())||"",whatsapp_number:((l=a.whatsapp_number)==null?void 0:l.replace("+971","").trim())||"",company_name:a.company_name||"",bio:a.bio||""}),f(a.photo_url||null))},[a]);const _=s=>{if(s.target.files&&s.target.files[0]){const l=s.target.files[0];w(l),f(URL.createObjectURL(l))}},n=s=>{x(l=>({...l,[s.target.name]:s.target.value}))},C=async s=>{if(s.preventDefault(),!u||!a)return;m(!0);let l=a.photo_url;if(c)try{const i=`${u.id}/${Date.now()}_${c.name}`,{error:j}=await y.storage.from("avatars").upload(i,c,{upsert:!0});if(j)throw j;const{data:U}=y.storage.from("avatars").getPublicUrl(i);l=U.publicUrl}catch(i){d("Upload Failed",i.message||"An error occurred while uploading the avatar."),m(!1);return}const S={...t,phone:t.phone?`+971 ${t.phone}`:null,whatsapp_number:t.whatsapp_number?`+971 ${t.whatsapp_number}`:null,photo_url:l};v.mutate(S,{onSuccess:()=>{d("Profile Saved","Your information has been updated successfully."),p("/account")},onError:i=>{d("Save Failed",i.message||"An error occurred while saving your profile.")},onSettled:()=>{m(!1)}})};return N?e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{className:"h-8 w-40"}),e.jsx("div",{className:"bg-white p-6 rounded-xl border shadow-sm",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx(r,{className:"w-24 h-24 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(r,{className:"h-6 w-3/4"}),e.jsx(r,{className:"h-4 w-1/2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{className:"h-16"}),e.jsx(r,{className:"h-16"}),e.jsx(r,{className:"h-16"}),e.jsx(r,{className:"h-16"})]})]})})]}):e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{type:"button",onClick:()=>p(-1),className:"flex items-center text-sm font-medium text-gray-600 hover:text-gray-900",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Back to Account"]}),e.jsx("button",{type:"submit",disabled:g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50 flex items-center",children:g?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2"})," Save Changes"]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border shadow-sm space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden",children:h?e.jsx("img",{src:h,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(E,{className:"w-12 h-12 text-gray-400"})}),e.jsx("button",{type:"button",onClick:()=>{var s;return(s=b.current)==null?void 0:s.click()},className:"absolute bottom-0 right-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center shadow hover:bg-blue-700",children:e.jsx($,{className:"w-4 h-4"})}),e.jsx("input",{type:"file",ref:b,onChange:_,accept:"image/*",className:"hidden"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Update Your Profile"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Keep your personal details up to date."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Full Name"}),e.jsx("input",{type:"text",name:"full_name",value:t.full_name,onChange:n,className:"w-full mt-1 p-2 border rounded-md bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{type:"email",value:(a==null?void 0:a.email)||"",readOnly:!0,className:"w-full mt-1 p-2 border rounded-md bg-gray-200 text-gray-500 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Designation"}),e.jsx("input",{type:"text",name:"designation",value:t.designation,onChange:n,className:"w-full mt-1 p-2 border rounded-md bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Company Name"}),e.jsx("input",{type:"text",name:"company_name",value:t.company_name,onChange:n,className:"w-full mt-1 p-2 border rounded-md bg-gray-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Mobile Number"}),e.jsxs("div",{className:"flex mt-1",children:[e.jsx("span",{className:"inline-flex items-center px-3 text-sm bg-gray-100 border border-r-0 rounded-l-md",children:"+971"}),e.jsx("input",{type:"tel",name:"phone",value:t.phone,onChange:n,className:"w-full p-2 border rounded-r-md bg-gray-50",placeholder:"50 123 4567"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"WhatsApp Number"}),e.jsxs("div",{className:"flex mt-1",children:[e.jsx("span",{className:"inline-flex items-center px-3 text-sm bg-gray-100 border border-r-0 rounded-l-md",children:"+971"}),e.jsx("input",{type:"tel",name:"whatsapp_number",value:t.whatsapp_number,onChange:n,className:"w-full p-2 border rounded-r-md bg-gray-50",placeholder:"55 987 6543"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Bio"}),e.jsx("textarea",{name:"bio",value:t.bio,onChange:n,rows:3,placeholder:"Tell us a bit about yourself...",className:"w-full mt-1 p-2 border rounded-md bg-gray-50"})]})]})]})]})}export{K as default};
