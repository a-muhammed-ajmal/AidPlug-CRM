import{R as V,j as e,p as O,D as P,B as L,e as U,r as m,f as q,u as W,S,a as G,l as M,X as H,w as K,n as Q,o as Y}from"./index-BK3vLjjw.js";import{D as X,a as B,P as R,T as J,E as Z}from"./DropdownMenu-BoZjJ_c2.js";import{C as k}from"./calendar-rSHHqglV.js";import{P as ee,S as le}from"./search-1_S-E33i.js";import{M as se}from"./mail-DYQVG9aa.js";import{P as ae}from"./plus-CrSJm-vq.js";import{T as te,H as T}from"./trending-up-CM-nZk9k.js";import{C as z}from"./chevron-down-CsYsS9Ug.js";const re=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.586-1.456l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.269.654 4.495 1.932 6.22l-1.023 3.744 3.845-1.004zm-3.837 1.387l.494.296c1.695 1.011 3.58 1.574 5.63 1.576 6.245 0 11.33-5.084 11.332-11.33.001-6.247-5.085-11.332-11.334-11.332-6.245 0-11.331 5.085-11.333 11.331.001 2.431.792 4.78 2.215 6.64l.43.586-1.24 4.545 4.66-1.219z"})}),ne=V.memo(({deal:a,onView:n,onEdit:l,onDelete:u})=>{var f;const x=(o,s)=>{o.stopPropagation(),s()},y=()=>{a.mobile_number&&(window.location.href=`tel:${a.mobile_number.replace(/\s/g,"")}`)},i=()=>{a.email_address&&(window.location.href=`mailto:${a.email_address}`)},g=()=>{if(a.whatsapp_number){const o=a.whatsapp_number.replace(/[^0-9]/g,"");window.open(`https://wa.me/${o}`,"_blank")}};return e.jsxs("div",{onClick:()=>n(a),className:"bg-white rounded-lg shadow-sm p-4 border border-gray-200 hover:shadow-md transition-shadow cursor-pointer active:scale-95",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1 pr-2",children:[e.jsx("h4",{className:"font-semibold text-gray-800",children:a.client_name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 truncate",title:a.title,children:a.title})]}),e.jsx(X,{trigger:e.jsx(Z,{className:"w-4 h-4 text-gray-500"}),children:e.jsxs(e.Fragment,{children:[e.jsx(B,{onClick:o=>{o.stopPropagation(),l(a)},icon:e.jsx(R,{className:"w-4 h-4 mr-2"}),children:"Edit"}),e.jsx(B,{onClick:o=>{o.stopPropagation(),u(a)},icon:e.jsx(J,{className:"w-4 h-4 mr-2"}),className:"text-red-600",children:"Delete"})]})})]}),e.jsxs("div",{className:"space-y-2 text-sm border-t pt-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[e.jsx(O,{className:"w-3.5 h-3.5 flex-shrink-0"}),e.jsxs("span",{className:"truncate",title:`${a.designation} at ${a.company_name}`,children:[a.designation," at ",a.company_name]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[e.jsx(P,{className:"w-3.5 h-3.5 flex-shrink-0"}),e.jsxs("span",{className:"font-medium",children:["AED ",((f=a.monthly_salary)==null?void 0:f.toLocaleString())||"N/A"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[e.jsx(L,{className:"w-3.5 h-3.5 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:a.product||void 0,children:a.product})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-gray-500",children:[e.jsx(k,{className:"w-3.5 h-3.5 flex-shrink-0"}),e.jsxs("span",{children:["Submitted:"," ",new Date(a.created_at||Date.now()).toLocaleDateString("en-GB")]})]})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3 mt-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsxs("button",{onClick:o=>x(o,y),disabled:!a.mobile_number,className:"flex items-center justify-center py-2 px-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-xs font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ee,{className:"w-3.5 h-3.5 mr-1.5"})," Call"]}),e.jsxs("button",{onClick:o=>x(o,g),disabled:!a.whatsapp_number,className:"flex items-center justify-center py-2 px-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-xs font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(re,{})," ",e.jsx("span",{className:"ml-1.5",children:"WhatsApp"})]}),e.jsxs("button",{onClick:o=>x(o,i),disabled:!a.email_address,className:"flex items-center justify-center py-2 px-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-xs font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(se,{className:"w-3.5 h-3.5 mr-1.5"})," Email"]})]})})]})}),oe=({stage:a,deals:n,onViewDeal:l,onEditDeal:u,onDeleteDeal:x})=>{const y={blue:"bg-blue-100 text-blue-800 border-blue-200",yellow:"bg-yellow-100 text-yellow-800 border-yellow-200",purple:"bg-purple-100 text-purple-800 border-purple-200",green:"bg-green-100 text-green-800 border-green-200",red:"bg-red-100 text-red-800 border-red-200"};return e.jsxs("div",{className:"flex-shrink-0 w-[calc(100vw-3rem)] sm:w-80 h-full flex flex-col snap-center border rounded-xl overflow-hidden shadow-sm",children:[e.jsxs("div",{className:`${y[a.color]} p-3`,children:[e.jsx("h3",{className:"font-semibold text-sm",children:a.label}),e.jsxs("p",{className:"text-xs mt-1",children:[n.length," deals"]})]}),e.jsx("div",{className:"space-y-3 overflow-y-auto flex-grow p-3 bg-gray-50",children:n.map(i=>e.jsx(ne,{deal:i,onView:l,onEdit:u,onDelete:x},i.id))})]})},F={title:"",client_name:"",company_name:"",designation:"",monthly_salary:"",bank_applying:"Emirates Islamic Bank",product_type:"Credit Card",product:M[0].name,mobile_number:"",email_address:"",whatsapp_number:"",amount:"",stage:"application_processing",expected_close_date:new Date().toISOString().split("T")[0],completed_date:"",application_number:"",bdi_number:"",aecb_score:""},$=K.map(a=>({value:a.id,label:a.title})),p=({icon:a,label:n,value:l})=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"bg-gray-100 p-2 rounded-lg mt-1",children:e.jsx(a,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:n}),e.jsx("p",{className:"font-medium text-gray-800",children:l||"N/A"})]})]}),A=({title:a,children:n})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:col-span-2 mt-4 first:mt-0",children:e.jsx("h3",{className:"text-base font-semibold text-gray-800 border-b pb-2",children:a})}),n]}),d=({label:a,children:n,required:l})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[a,l&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),n]}),E=({id:a,name:n,value:l,onChange:u,options:x,required:y})=>e.jsxs("div",{className:"relative",children:[e.jsx("select",{id:a,name:n,value:l,onChange:u,required:y,className:"w-full appearance-none bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-3 pr-10",children:x.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))}),e.jsx(z,{className:"w-4 h-4 text-gray-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none"})]});function ce({isOpen:a,onClose:n,initialData:l,initialMode:u="view"}){var C;const{createDeal:x,updateDeal:y}=q(),{user:i}=G(),{addNotification:g}=U(),[f,o]=m.useState(l?u:"edit"),[s,_]=m.useState(F),[v,b]=m.useState(!1),[N,D]=m.useState(M.map(t=>t.name));m.useEffect(()=>{let t=[];s.bank_applying==="Emirates Islamic Bank"&&s.product_type==="Credit Card"?t=M.map(h=>h.name):s.product_type==="Account Opening"&&(t=["Personal Account","Business Account"]),D(t),t.includes(s.product)||_(h=>({...h,product:t[0]||""}))},[s.bank_applying,s.product_type]),m.useEffect(()=>{var t;l?(_({title:l.title||"",client_name:l.client_name||"",amount:String(l.amount||""),stage:l.stage||"application_processing",expected_close_date:l.expected_close_date?l.expected_close_date.split("T")[0]:new Date().toISOString().split("T")[0],completed_date:l.completed_date?l.completed_date.split("T")[0]:"",application_number:l.application_number||"",bdi_number:l.bdi_number||"",company_name:l.company_name||"",designation:l.designation||"",monthly_salary:String(l.monthly_salary||""),bank_applying:l.bank_applying||"Emirates Islamic Bank",product_type:l.product_type||"Credit Card",product:l.product||"",mobile_number:((t=l.mobile_number)==null?void 0:t.replace("+971","").trim())||"",email_address:l.email_address||"",whatsapp_number:l.whatsapp_number||"",aecb_score:String(l.aecb_score||"")}),o(u)):(_(F),o("edit"))},[l,u,a]);const c=t=>{const{name:h,value:j}=t.target;_(r=>{const w={...r,[h]:j};return h==="product_type"&&j==="Credit Card"&&(w.amount=""),w})},I=t=>{if(t.preventDefault(),!i){g("Authentication Error","You must be logged in.");return}b(!0);const h={...s,user_id:i.id,amount:parseInt(s.amount,10)||0,monthly_salary:parseInt(s.monthly_salary,10)||null,mobile_number:s.mobile_number?`+971 ${s.mobile_number}`:null,completed_date:s.stage==="completed"&&s.completed_date||null,aecb_score:s.aecb_score?parseInt(s.aecb_score,10):null};l?y.mutate({id:l.id,updates:h},{onSuccess:()=>{g("Deal Updated",`${s.title} has been saved.`),n()},onError:j=>g("Error",j.message),onSettled:()=>b(!1)}):x.mutate(h,{onSuccess:()=>{g("Deal Created",`${s.title} has been saved.`),n()},onError:j=>g("Error",j.message),onSettled:()=>b(!1)})};return a?e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex justify-center items-end animate-fade-in sm:items-center",children:e.jsxs("div",{className:"bg-white w-full max-w-2xl rounded-t-2xl sm:rounded-xl shadow-xl flex flex-col max-h-[90vh] animate-slide-up",children:[e.jsxs("header",{className:"flex items-center justify-between p-4 border-b flex-shrink-0",children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:f==="edit"?l?"Edit Deal":"Add New Deal":(l==null?void 0:l.title)||"Deal Details"}),e.jsx("button",{onClick:n,className:"p-2 -mr-2 rounded-full hover:bg-gray-100",children:e.jsx(H,{className:"w-5 h-5 text-gray-600"})})]}),f==="view"&&l?e.jsxs(e.Fragment,{children:[e.jsxs("main",{className:"flex-1 p-6 overflow-y-auto space-y-4",children:[e.jsx(p,{icon:L,label:"Client",value:l.client_name}),l.product_type!=="Credit Card"&&e.jsx(p,{icon:P,label:"Amount",value:`AED ${l.amount.toLocaleString()}`}),e.jsx(p,{icon:O,label:"Company",value:l.company_name}),e.jsx(p,{icon:L,label:"Designation",value:l.designation}),e.jsx(p,{icon:P,label:"Salary",value:l.monthly_salary?`AED ${l.monthly_salary.toLocaleString()}`:null}),e.jsx(p,{icon:te,label:"AECB Score",value:l.aecb_score}),e.jsx(p,{icon:k,label:"Submission Date",value:new Date(l.created_at||"").toLocaleDateString()}),l.stage==="completed"?e.jsx(p,{icon:k,label:"Completed Date",value:l.completed_date?new Date(l.completed_date).toLocaleDateString():"N/A"}):e.jsx(p,{icon:k,label:"Expected Close",value:l.expected_close_date?new Date(l.expected_close_date).toLocaleDateString():null}),e.jsx(p,{icon:T,label:"Application No.",value:l.application_number}),e.jsx(p,{icon:T,label:"BDI No.",value:l.bdi_number}),e.jsx(p,{icon:z,label:"Stage",value:((C=$.find(t=>t.value===l.stage))==null?void 0:C.label)||"N/A"})]}),e.jsx("footer",{className:"p-4 bg-gray-50 border-t flex-shrink-0",children:e.jsxs("button",{onClick:()=>o("edit"),className:"w-full py-3 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all active:scale-95 shadow flex items-center justify-center",children:[e.jsx(R,{className:"w-4 h-4 mr-2"})," Edit Deal"]})})]}):e.jsxs("form",{onSubmit:I,className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("main",{className:"flex-1 p-6 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsx(A,{title:"Application Details",children:e.jsxs(e.Fragment,{children:[e.jsx(d,{label:"Application Number",children:e.jsx("input",{type:"text",name:"application_number",value:s.application_number,onChange:c,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(d,{label:"BPM ID",children:e.jsx("input",{type:"text",name:"bdi_number",value:s.bdi_number,onChange:c,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(d,{label:"Status / Stage",children:e.jsx(E,{id:"stage",name:"stage",value:s.stage||"application_processing",onChange:c,options:$})}),s.stage==="completed"?e.jsx(d,{label:"Completed Date",required:!0,children:e.jsx("input",{type:"date",name:"completed_date",value:s.completed_date,onChange:c,max:new Date().toISOString().split("T")[0],required:!0,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}):e.jsx(d,{label:"Expected Close Date",children:e.jsx("input",{type:"date",name:"expected_close_date",value:s.expected_close_date,onChange:c,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})})]})}),e.jsx(A,{title:"Client Information",children:e.jsxs(e.Fragment,{children:[e.jsx(d,{label:"Full Name",required:!0,children:e.jsx("input",{type:"text",name:"client_name",value:s.client_name,onChange:c,required:!0,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(d,{label:"Company Name",children:e.jsx("input",{type:"text",name:"company_name",value:s.company_name,onChange:c,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(d,{label:"Designation",children:e.jsx("input",{type:"text",name:"designation",value:s.designation,onChange:c,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(d,{label:"Monthly Salary (AED)",children:e.jsx("input",{type:"number",name:"monthly_salary",value:s.monthly_salary,onChange:c,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(d,{label:"AECB Score",children:e.jsx("input",{type:"number",name:"aecb_score",value:s.aecb_score,onChange:c,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})})]})}),e.jsx(A,{title:"Product Details",children:e.jsxs(e.Fragment,{children:[e.jsx(d,{label:"Bank Applying",children:e.jsx(E,{id:"bank_applying",name:"bank_applying",value:s.bank_applying,onChange:c,options:Q.map(t=>({value:t,label:t}))})}),e.jsx(d,{label:"Product Type",children:e.jsx(E,{id:"product_type",name:"product_type",value:s.product_type,onChange:c,options:Y.map(t=>({value:t,label:t}))})}),N.length>0&&e.jsx(d,{label:"Product",children:e.jsx(E,{id:"product",name:"product",value:s.product,onChange:c,options:N.map(t=>({value:t,label:t}))})}),s.product_type!=="Credit Card"&&e.jsx(d,{label:"Amount (AED)",required:!0,children:e.jsx("input",{type:"number",name:"amount",value:s.amount,onChange:c,required:!0,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})})]})}),e.jsx(A,{title:"Contact Information",children:e.jsxs(e.Fragment,{children:[e.jsx(d,{label:"Mobile Number",children:e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"inline-flex items-center px-3 text-sm text-gray-900 bg-gray-50 border border-r-0 border-gray-300 rounded-l-lg",children:"+971"}),e.jsx("input",{type:"tel",name:"mobile_number",value:s.mobile_number,onChange:c,className:"w-full bg-white border border-gray-300 p-3 rounded-r-lg",placeholder:"50 123 4567"})]})}),e.jsx(d,{label:"Email Address",children:e.jsx("input",{type:"email",name:"email_address",value:s.email_address,onChange:c,className:"w-full bg-white border border-gray-300 p-3 rounded-lg"})}),e.jsx(d,{label:"WhatsApp Number",children:e.jsx("input",{type:"text",name:"whatsapp_number",value:s.whatsapp_number,onChange:c,className:"w-full bg-white border border-gray-300 p-3 rounded-lg",placeholder:"+9715..."})})]})})]}),e.jsx("footer",{className:"p-4 bg-gray-50 border-t flex-shrink-0",children:e.jsx("button",{type:"submit",disabled:v,className:"w-full py-3 px-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all active:scale-95 shadow disabled:opacity-50",children:v?"Saving...":l?"Update Deal":"Save Deal"})})]})]})}):null}function ge(){const{showConfirmation:a,addNotification:n,setTitle:l}=U();m.useEffect(()=>{l("Deals")},[l]);const{deals:u,isLoading:x,deleteDeal:y}=q(),i=W(),[g,f]=m.useState(!1),[o,s]=m.useState(null),[_,v]=m.useState("view"),[b,N]=m.useState(""),D=[{id:"application_processing",label:"Application Processing",color:"blue"},{id:"verification_needed",label:"Verification Needed",color:"yellow"},{id:"activation_needed",label:"Activation Needed",color:"purple"},{id:"completed",label:"Completed",color:"green"},{id:"unsuccessful",label:"Unsuccessful",color:"red"}],c=m.useMemo(()=>u?u.filter(r=>!b||r.client_name.toLowerCase().includes(b.toLowerCase())||r.title.toLowerCase().includes(b.toLowerCase())||r.company_name&&r.company_name.toLowerCase().includes(b.toLowerCase())||r.application_number&&r.application_number.toLowerCase().includes(b.toLowerCase())):[],[b,u]),I=r=>{s(r),v("view"),f(!0)},C=r=>{s(r),v("edit"),f(!0)},t=m.useCallback(()=>{s(null),v("edit"),f(!0)},[]);m.useEffect(()=>{var r;(r=i.state)!=null&&r.showAddModal&&(t(),window.history.replaceState({},document.title))},[i.state,t]);const h=r=>{a("Delete Deal?",`Are you sure you want to permanently delete the deal "${r.title}"? This action cannot be undone.`,()=>{y.mutate(r.id,{onSuccess:()=>n("Deal Deleted","The deal has been successfully removed."),onError:w=>n("Error",w.message||"Failed to delete deal.")})})},j=()=>{f(!1),s(null)};return x?e.jsxs("div",{className:"relative flex flex-col h-[calc(100vh-148px)] lg:h-[calc(100vh-110px)]",children:[e.jsx("div",{className:"p-4 bg-gray-50 border-b flex-shrink-0",children:e.jsx(S,{className:"h-10 w-full rounded-lg"})}),e.jsx("div",{className:"flex-grow overflow-x-auto kanban-board",children:e.jsx("div",{className:"flex space-x-4 p-4 h-full",children:[...Array(3)].map((r,w)=>e.jsxs("div",{className:"flex-shrink-0 w-[calc(100vw-3rem)] sm:w-80 h-full flex flex-col",children:[e.jsx(S,{className:"h-16 w-full rounded-t-xl"}),e.jsxs("div",{className:"space-y-3 p-3 bg-gray-50 flex-grow rounded-b-xl border",children:[e.jsx(S,{className:"h-32 w-full rounded-lg"}),e.jsx(S,{className:"h-32 w-full rounded-lg"})]})]},w))})})]}):e.jsxs("div",{className:"relative flex flex-col h-[calc(100vh-148px)] lg:h-[calc(100vh-110px)]",children:[e.jsx("div",{className:"p-4 bg-gray-50 border-b flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search deals by client, title, company...",value:b,onChange:r=>N(r.target.value),className:"w-full pl-10 pr-4 py-2 border bg-white border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"})]})}),e.jsx("div",{className:"flex-grow overflow-x-auto kanban-board bg-gray-50",children:e.jsx("div",{className:"flex space-x-4 p-4 h-full",children:D.map(r=>e.jsx(oe,{stage:r,deals:c.filter(w=>w.stage===r.id),onViewDeal:I,onEditDeal:C,onDeleteDeal:h},r.id))})}),e.jsx("button",{onClick:t,className:"fixed bottom-20 right-5 z-30 w-14 h-14 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-blue-700 transition-all active:scale-90","aria-label":"Add new deal",children:e.jsx(ae,{className:"w-7 h-7"})}),g&&e.jsx(ce,{isOpen:g,onClose:j,initialData:o,initialMode:_})]})}export{ge as default};
